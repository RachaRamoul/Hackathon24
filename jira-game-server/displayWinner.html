<!DOCTYPE html>
<html>

<head>
    <title>Winner Display</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            margin: 0;
        }

        .container {
            text-align: center;
            color: #2784ff;
            padding: 20px;
        }

        .input-container {
            margin-bottom: 10px;
        }

        .input-container input {
            margin-right: 10px;
            background-color: #f0f0f0;
            width: 350px;
            height: 45px;
            border-radius: 15px;
            border: none;
            outline: none;
            text-indent: 10px;
        }

        .input-container label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            margin-right: 200px;
        }

        #startButton {
            margin-right: 10px;
            margin-top: 10px;
            background-color: #2784ff;
            width: 350px;
            height: 45px;
            border-radius: 15px;
            border: none;
            outline: none;
            cursor: pointer;
            color: white;
            font-weight: bold;
        }

        #winner {
            font-size: 2em;
            color: #333;
            margin-top: 20px;
        }

        #timer {
            font-size: 1.5em;
            color: #666;
            margin-bottom: 10px;
            margin-top: 10px;
        }

        .result {
            margin-top: 20px;
        }

        .result span {
            margin-right: 20px;
        }

        .winner {
            font-size: 1.5em;
            color: green;
            font-weight: bold;
        }

        .container h2 {
            font-weight: normal;
        }

        .logo {
            width: 30px;
            height: auto;
            margin-right: 10px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo-container h2 {
            margin: 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="logo-container">
            <img class="logo" src="https://cdn.icon-icons.com/icons2/2699/PNG/512/atlassian_jira_logo_icon_170511.png"
                alt="Jira Logo">
            <h2>Sign up to take part in our JIRA game !</h2>
        </div>
        <div class="input-container">
            <label for="player1">PLAYER 1 (NAME) :</label>
            <input type="text" id="player1" placeholder="As configured in Jira">
        </div>
        <div class="input-container">
            <label for="player2">PLAYER 2 (NAME)</label>
            <input type="text" id="player2" placeholder="As configured in Jira">
        </div>
        <div class="input-container">
            <label for="time">GAME DURATION</label>
            <input type="number" id="time" placeholder="7h" min="0" max="120">
        </div>
        <button id="startButton" onclick="startGame()">LET'S PLAY !</button>
        <div id="timer"></div>
        <div class="result" id="result"></div>
        <div id="winner"></div>
    </div>

    <script>
        function startGame() {
            const player1 = document.getElementById('player1').value;
            const player2 = document.getElementById('player2').value;
            const time = document.getElementById('time').value || 1; // Default time is set to 1 minute
    
            // Start the timer
            const timerDisplay = document.getElementById('timer');
            startTimer(time * 60, timerDisplay, () => {
                fetch(`http://localhost:3000/winner?user1=${player1}&user2=${player2}&time=${time}`)
                    .then(response => response.json())
                    .then(data => {
                        displayResult(data);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            });
        }
    
        function startTimer(duration, display, callback) {
            let timer = duration, minutes, seconds;
            const intervalId = setInterval(function () {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);
    
                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;
    
                if (timer <= 30) {
                    display.style.color = 'red';
                } else {
                    display.style.color = '#666';
                }
    
                display.textContent = minutes + ":" + seconds;
    
                if (--timer < 0) {
                    clearInterval(intervalId);
                    callback();
                }
            }, 1000);
        }
    
        function displayResult(data) {
            const winner = document.getElementById('winner');
            if (data.user1.count > data.user2.count) {
                winner.innerHTML = `<div class="winner">${data.user1.name} is the winner with ${data.user1.count} resolved issues!</div>`;
            } else if (data.user2.count > data.user1.count) {
                winner.innerHTML = `<div class="winner">${data.user2.name} is the winner with ${data.user2.count} resolved issues!</div>`;
            } else {
                winner.innerHTML = `<div class="winner">It's a tie! Both ${data.user1.name} and ${data.user2.name} have resolved ${data.user1.count} issues.</div>`;
            }
        }
    </script>
</body>
</html>
